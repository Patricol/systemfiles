* DO BEFORE STARTING:
  * CHECK THAT THE SYSTEMFILES REPO IS UP TO DATE AND PUSHED ETC.
    * re-run save-system-info and push the updated package lists


gcloud compute --project=personal-patricol instances create onsite --zone=us-west2-c --machine-type=n1-standard-4 --subnet=default --network-tier=PREMIUM --no-restart-on-failure --maintenance-policy=MIGRATE --service-account=389147822951-compute@developer.gserviceaccount.com --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append --min-cpu-platform="Intel Skylake" --image-project=arch-linux-gce --image-family=arch --boot-disk-size=64GB --boot-disk-type=pd-ssd --boot-disk-device-name=onsite

ssh in
sudo -i
pacman -Syu --needed git vim openssh zsh base-devel pigz pacman-contrib
git clone -b arch --bare https://github.com/Patricol/systemfiles.git /root/systemfiles-repo
alias gsf='git --git-dir=/root/systemfiles-repo --work-tree=/'
alias gsfch='gsf checkout -f gce --'
gsfch /root /usr/local /etc/{hosts,sudoers,makepkg.conf,pacman*,ssh}

chsh -s /bin/zsh patrickcp0
groupadd -r sudo
groupadd -r ssh
usermod -aG sudo patrickcp0
usermod -aG ssh patrickcp0

#switch to patrickcp0

git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -sci && cd .. && rm -rf ./yay/

alias gsf='sudo git --git-dir=/root/systemfiles-repo/ --work-tree=/'
gsf config --local status.showUntrackedFiles no


sudo sort-mirrors
#ensure /etc/makepkg.conf is checked out before installing the AUR packages, or they'll take an eternity to compress.
yay --needed -Syu $(sudo cat /root/info/packages/explicit.txt)


gsf checkout -f
(checkout -f to force, but first check in what they modify, for posterity and to make it easier to reapply changes on top of newer base configs. when done, remove this notice.)

sudo fix-permissions


Setup dotfiles if needed: https://github.com/Patricol/dotfiles

#exec startx for gui (assuming exec i3 is in ~/.xinitrc)

sudo usermod -aG libvirt patrickcp0

#sets default terminal for nemo to use from right click menu etc.
gsettings set org.cinnamon.desktop.default-applications.terminal exec urxvt
sudo -u work -i dbus-launch --exit-with-session gsettings set org.cinnamon.desktop.default-applications.terminal exec urxvt


sudo systemctl mask hibernate.target suspend-then-hibernate.target hybrid-sleep.target suspend.target sleep.target ctrl-alt-del.target
#disable hibernation and suspend. Sleep seems to be the same thing. DPMS and "screen blanking" are distinct from all of these. Also disable rebooting with ctrl alt del.
#this also means there's no reason for me to use caffeine; I was using it to keep the computer from suspending when programs were running.
sudo systemctl preset-all
sudo journalctl --vacuum-size=100M && sudo systemctl restart systemd-journald.service

sudo mkinitcpio -P
reboot

sudo vncpasswd /etc/vncpasswd

ln -sf /home/patrickcp0/.gitconfig /root/.gitconfig

gsfp --set-upstream origin gce


#If you didn't copy over files for atom:
#apm install atom-material-ui atom-material-syntax-dark atom-beautify file-icons language-docker angularjs react language-markdown linter linter-pylama linter-clang linter-gcc linter-cpplint advanced-open-file code-peek emmet fonts git-time-machine jumpy minimap sort-lines script todo-show pigments highlight-selected language-smali git-blame color-picker language-autohotkey2 dark-flat-ui
#open atom gui
#close atom gui
#apm disable git-blame color-picker spell-check minimap tree-view

